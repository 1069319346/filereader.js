/*!
    FileReader.js - a lightweight wrapper for common FileReader usage.
    Copyright 2012 Brian Grinstead - MIT License.
    See http://github.com/bgrins/filereader.js for documentation.
    Built: 2012-05-25 ap 06:05:54
*/

(function(a){function i(a,b){function d(a){var b=[],d=a.clipboardData||{},e=d.items||[];for(var f=0;f<e.length;f++){var g=e[f].getAsFile();if(g){var h=(new RegExp("image/(.*)")).exec(g.type);if(h){var i=h[1];g.name="clipboard"+f+"."+i,b.push(g)}}}b.length&&(n(b,c),a.preventDefault(),a.stopPropagation())}if(!h.enabled)return;var c=r(r({},h.opts),b);a.addEventListener("paste",d,!1)}function j(a,b){function d(a){n(a.target.files,c)}if(!h.enabled)return;var c=r(r({},h.opts),b);a.addEventListener("change",d,!1)}function k(a,b){function f(a){return function(){if(e)return;a.apply(this,arguments)}}function g(a){e=!1}function i(a){e=!0}function j(a){a.dataTransfer.files&&a.dataTransfer.files.length&&(a.stopPropagation(),a.preventDefault())}function k(b){b.stopPropagation(),b.preventDefault(),d&&u(a,d),n(b.dataTransfer.files,c)}function l(b){d&&t(a,d),b.stopPropagation(),b.preventDefault()}function m(b){d&&u(a,d)}function o(b){d&&t(a,d),b.stopPropagation(),b.preventDefault()}if(!h.enabled)return;var c=r(r({},h.opts),b),d=c.dragClass;document.body.addEventListener("dragstart",i,!0),document.body.addEventListener("dragend",g,!0),document.body.addEventListener("drop",j,!1),a.addEventListener("dragenter",f(l),!1),a.addEventListener("dragleave",f(m),!1),a.addEventListener("dragover",f(o),!1),a.addEventListener("drop",f(k),!1);var e=!1}function l(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.extra={nameNoExtension:d.name.substring(0,d.name.lastIndexOf(".")),extension:d.name.substring(d.name.lastIndexOf(".")+1),fileID:c,uniqueID:x(),groupID:b,prettySize:v(d.size)}}}function m(a,b,c){for(var d in b)if(a.match(new RegExp(d)))return"readAs"+b[d];return"readAs"+c}function n(a,c){var d={groupID:w(),files:a,started:new Date};h.output.push(d);var i=a.length,j=function(){--i==0&&(d.ended=new Date,c.on.groupend(d))};l(a,d.groupID),c.on.groupstart(d),a.length||(d.ended=new Date,c.on.groupend(d));var k=h.sync&&e&&f,n;k&&(n=new Worker(f),n.onmessage=function(a){var b=a.data.file;b.extra||(b.extra=a.data.extra),a.data.result==="error"?c.on.error({},b):c.on.load({target:{result:a.data.result}},b),j()}),Array.prototype.forEach.call(a,function(a){if(c.accept&&!a.type.match(new RegExp(c.accept))){c.on.skip(a),j();return}if(c.on.beforestart(a)===!1){c.on.skip(a),j();return}var d=m(a.type,c.readAsMap,c.readAsDefault);if(k)n.postMessage({file:a,extra:a.extra,readAs:d});else{var e=new b;g.forEach(function(b){e["on"+b]=function(d){c.on[b](d,a),b=="loadend"&&j()}}),e[d](a)}})}function o(){var a=p("self.addEventListener('message',function(e){ postMessage(!!FileReaderSync); }, false);");if(a){var b=new Worker(a);b.onmessage=function(b){e=b.data,d.revokeObjectURL(a)},b.postMessage()}}function p(a){if(window.Worker&&c&&d){var b=new c;return b.append(a),d.createObjectURL(b.getBlob())}return null}function q(){}function r(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=b[c];return a}function s(a,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(a.className)}function t(a,b){s(a,b)||(a.className=a.className?[a.className,b].join(" "):b)}function u(a,b){if(s(a,b)){var c=a.className;a.className=c.replace(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)","g")," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}function v(a){var b=["bytes","kb","MB","GB","TB","PB"],c=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(c))).toFixed(2)+" "+b[c]}var b=a.FileReader,c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,d=window.URL||window.webkitURL,e=!1,f=p("self.addEventListener('message',function(e){var data=e.data;try{var reader=new FileReaderSync;postMessage({result:reader[data.readAs](data.file),extra:data.extra,file:data.file})}catch(e){postMessage({result:'error',extra:data.extra,file:data.file})}},false);"),g=["loadstart","progress","load","abort","error","loadend"],h=a.FileReaderJS={enabled:!1,setupInput:j,setupDrop:k,setupClipboard:i,sync:!1,opts:{dragClass:"drag",accept:!1,readAsMap:{"image/*":"DataURL","text/*":"Text"},readAsDefault:"BinaryString",on:{loadstart:q,progress:q,load:q,abort:q,error:q,loadend:q,skip:q,groupstart:q,groupend:q,beforestart:q}},output:[]};typeof jQuery!="undefined"&&(jQuery.fn.fileReaderJS=function(a){return this.each(function(){$(this).is("input")?j(this,a):k(this,a)})},jQuery.fn.fileClipboard=function(a){return this.each(function(){i(this,a)})});if(!b)return;o();var w=function(a){return function(){return a++}}(0),x=function(a){return function(){return a++}}(0);h.enabled=!0})(this);