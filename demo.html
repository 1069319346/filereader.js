<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<script type='text/javascript' src='filereader.js'></script>
	<style type='text/css'>
	#dropbox {padding:20px;  border: solid 1px green; }
	#dropbox.drag { border: solid 1px red; }
	#preview { margin-top:10px; }
	#preview>div { border: solid 2px; margin:20px; padding:10px;}
	#preview pre { margin:20px 0; border: solid 2px #d88; }
 
	</style>
</head>

<body>

<form>
  <input type="file" id="fileElem" multiple />
  <div id='dropbox'>Drag and drop files from your desktop here</div>
</form>
<div id="fileList">
  <div id='preview'></div>
</div>
<script type='text/javascript'>
function log() {console.log(arguments)};

var fileInput = document.getElementById('fileElem');
var dropbox = document.getElementById("dropbox");
var preview = document.getElementById("preview");

var opts = {
	readAs: 'DataURL',
	dragClass: 'drag',
	on: {
		load: function(e, file) {
			if (file.type.indexOf("image/") != -1) {
				var div = document.createElement("div");
				div.innerHTML = "<img src='" + e.target.result + "' alt='"+file.name+"' />";
				document.getElementById("group_" + file.groupID + "_file_" + file.id).
					appendChild(div);	
			}
		},
		loadstart: function(e) {
			
		},
		loadend: function(e) {
		
		},
		progress: function(e) {
		
		},
		skip: function(file) {
		
		},
		groupstart: function(groupID, files) {
			var data = document.createElement("div");
			data.innerHTML = groupTemplate(groupID, files);
			preview.appendChild(data);
		},
		groupend: function(groupID, files) {
			var end = document.createElement("div");
			end.innerHTML = "Ended: " + (new Date());
			document.getElementById("group_" + groupID).appendChild(end);
		}
	}
};

function groupTemplate(groupID, files) {
	var start = "<div id='group_" + groupID + "'>Group: " + groupID + " (" + files.length + " files)<br />Started: " + (new Date());
	
	var html = [];
	for (var i = 0; i < files.length; i++) {
		var file = files[i];
		html.push("<pre id='group_" + groupID + "_file_" + file.id + "'>");
		for (var p in file) {
			var type = typeof(file[p]);
			if (type == 'string' || type == 'number') {
				html.push(p + " - " + file[p] + '\n');
			}
		}
		html.push("</pre>");
	}
	
	return  start + html.join('') + "</div>";
}

FileReaderJS.setupInput(fileInput, opts);
FileReaderJS.setupDrop(dropbox, opts);
</script>
</body>
</html>
