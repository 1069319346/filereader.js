/*!
    FileReader.js - a lightweight wrapper for common FileReader usage.
    Copyright 2012 Brian Grinstead - MIT License.
    See http://github.com/bgrins/filereader.js for documentation.
    Built: 2012-05-26 12:05:56 PM
*/

(function(a){function i(a,b){function d(a){var b=[],d=a.clipboardData||{},e=d.items||[];for(var f=0;f<e.length;f++){var g=e[f].getAsFile();if(g){var h=(new RegExp("image/(.*)")).exec(g.type);if(h){var i=h[1];g.name="clipboard"+f+"."+i,b.push(g)}}}b.length&&(n(b,c),a.preventDefault(),a.stopPropagation())}var c=q(q({},g.opts),b);a.addEventListener("paste",d,!1)}function j(a,b){function d(a){n(a.target.files,c)}var c=q(q({},g.opts),b);a.addEventListener("change",d,!1)}function k(a,b){function f(a){return function(){if(e)return;a.apply(this,arguments)}}function h(a){e=!1}function i(a){e=!0}function j(a){a.dataTransfer.files&&a.dataTransfer.files.length&&(a.stopPropagation(),a.preventDefault())}function k(b){b.stopPropagation(),b.preventDefault(),d&&t(a,d),n(b.dataTransfer.files,c)}function l(b){d&&s(a,d),b.stopPropagation(),b.preventDefault()}function m(b){d&&t(a,d)}function o(b){d&&s(a,d),b.stopPropagation(),b.preventDefault()}var c=q(q({},g.opts),b),d=c.dragClass;document.body.addEventListener("dragstart",i,!0),document.body.addEventListener("dragend",h,!0),document.body.addEventListener("drop",j,!1),a.addEventListener("dragenter",f(l),!1),a.addEventListener("dragleave",f(m),!1),a.addEventListener("dragover",f(o),!1),a.addEventListener("drop",f(k),!1);var e=!1}function l(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.extra={nameNoExtension:d.name.substring(0,d.name.lastIndexOf(".")),extension:d.name.substring(d.name.lastIndexOf(".")+1),fileID:c,uniqueID:w(),groupID:b,prettySize:u(d.size)}}}function m(a,b,c){for(var d in b)if(a.match(new RegExp(d)))return"readAs"+b[d];return"readAs"+c}function n(a,d){var i={groupID:v(),files:a,started:new Date};g.output.push(i);var j=a.length,k=function(){--j==0&&(i.ended=new Date,d.on.groupend(i))};l(a,i.groupID),d.on.groupstart(i),a.length||(i.ended=new Date,d.on.groupend(i));var n=g.sync&&c,o;n&&(o=h.getWorker(e,function(a){var b=a.data.file;b.extra||(b.extra=a.data.extra),a.data.result==="error"?d.on.error({},b):d.on.load({target:{result:a.data.result}},b),k()})),Array.prototype.forEach.call(a,function(a){if(d.accept&&!a.type.match(new RegExp(d.accept))){d.on.skip(a),k();return}if(d.on.beforestart(a)===!1){d.on.skip(a),k();return}var c=m(a.type,d.readAsMap,d.readAsDefault);if(n&&o)o.postMessage({file:a,extra:a.extra,readAs:c});else{var e=new b;f.forEach(function(b){e["on"+b]=function(c){d.on[b](c,a),b=="loadend"&&k()}}),e[c](a)}})}function o(){var a=h.getURL("self.addEventListener('message', function(e) { postMessage(!!FileReaderSync); }, false);");if(a){var b=new Worker(a);b.onmessage=function(b){c=b.data,d.revokeObjectURL(a)},b.postMessage()}}function p(){}function q(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=b[c];return a}function r(a,b){return(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)")).test(a.className)}function s(a,b){r(a,b)||(a.className=a.className?[a.className,b].join(" "):b)}function t(a,b){if(r(a,b)){var c=a.className;a.className=c.replace(new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)","g")," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}function u(a){var b=["bytes","kb","MB","GB","TB","PB"],c=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(c))).toFixed(2)+" "+b[c]}var b=a.FileReader,c=!1,d=window.URL||window.webkitURL,e="self.addEventListener('message', function(e) { var data=e.data; try { var reader = new FileReaderSync; postMessage({ result: reader[data.readAs](data.file), extra: data.extra, file: data.file})} catch(e){ postMessage({ result:'error', extra:data.extra, file:data.file}); } }, false);",f=["loadstart","progress","load","abort","error","loadend"],g=a.FileReaderJS={enabled:!1,setupInput:j,setupDrop:k,setupClipboard:i,sync:!1,opts:{dragClass:"drag",accept:!1,readAsMap:{"image/*":"DataURL","text/*":"Text"},readAsDefault:"BinaryString",on:{loadstart:p,progress:p,load:p,abort:p,error:p,loadend:p,skip:p,groupstart:p,groupend:p,beforestart:p}},output:[]};typeof jQuery!="undefined"&&(jQuery.fn.fileReaderJS=function(a){return this.each(function(){if(!g.enabled)return;$(this).is("input")?j(this,a):k(this,a)})},jQuery.fn.fileClipboard=function(a){return this.each(function(){if(!g.enabled)return;i(this,a)})});if(!b)return;var h=function(){function b(b){if(window.Worker&&a&&d){var c=new a;return c.append(b),d.createObjectURL(c.getBlob())}return null}function c(a,c){var d=b(a);if(d){var e=new Worker(d);return e.onmessage=c,e}return null}var a=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;return{getURL:b,getWorker:c}}(),v=function(a){return function(){return a++}}(0),w=function(a){return function(){return a++}}(0);g.enabled=!0,o()})(this);